;/*FB_PKG_DELIM*/

__d("PolarisAPIGetFrCookie",["PolarisInstapi"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("PolarisInstapi").apiPost("/api/v1/web/accounts/get_encrypted_credentials/",{body:{payload:a}}).then(function(a){return a.data})}g.getFrCookie=a}),98);
__d("PolarisFacebookCookieSyncConstants",[],(function(a,b,c,d,e,f){"use strict";a={ready:"ig_iframe_ready",success:"ig_iframe_success",error:"ig_iframe_error",sync:"ig_iframe_fb_sync",ig_sync:"ig_iframe_ig_sync",ig_sync_success:"ig_iframe_ig_sync_success",ig_sync_error:"ig_iframe_ig_sync_error"};f.IFRAME_MESSAGES=a}),66);
__d("XPolarisFacebookSyncController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/sync/instagram/",{})}),null);
__d("buildIframeOriginUrl",["URI"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a}g["default"]=a}),98);
__d("PolarisFacebookToInstagramCookieSync.react",["FBLogger","PolarisDOMListener.react","PolarisFacebookCookieSyncConstants","PolarisODS","XAsyncRequest","XPolarisFacebookSyncController","buildIframeOriginUrl","gkx","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react"),i=d("react").useEffect,j=c("buildIframeOriginUrl")("https://www.facebook.com");function a(a){var b=a.frameRef,e=a.onCleanUp,f=c("gkx")("6534");i(function(){f||e()},[]);a=function(a){if(a.origin!==j)return;var b=a.data.eventName;switch(b){case d("PolarisFacebookCookieSyncConstants").IFRAME_MESSAGES.ready:g();break;case d("PolarisFacebookCookieSyncConstants").IFRAME_MESSAGES.ig_sync_success:c("PolarisODS").incr("web.cookie_sync.oo_cookie.retrieve_success");b=c("XPolarisFacebookSyncController").getURIBuilder().getURI();new(c("XAsyncRequest"))().setURI(b).setMethod("POST").setData({encrypted_data:(b=a.data.data)==null?void 0:b.data}).setHandler(function(a){c("PolarisODS").incr("web.cookie_sync.oo_cookie.sync_success")}).setErrorHandler(function(a){c("PolarisODS").incr("web.cookie_sync.oo_cookie.sync_fail");a=(a=a.errorDescription)!=null?a:"Error when syncing ig cookies";c("FBLogger")("ig_web").mustfix(a)}).send();e();break;case d("PolarisFacebookCookieSyncConstants").IFRAME_MESSAGES.ig_sync_error:c("PolarisODS").incr("web.cookie_sync.oo_cookie.retrieve_error");a=(b=a.data.errorDescription)!=null?b:"Exception thrown when syncing cookie to sync ig cookie";c("FBLogger")("ig_web").mustfix(a);e()}};var g=function(){c("PolarisODS").incr("web.cookie_sync.oo_cookie.start_fb_sync");var a=b.current;a==null?void 0:(a=a.contentWindow)==null?void 0:a.postMessage({eventName:d("PolarisFacebookCookieSyncConstants").IFRAME_MESSAGES.ig_sync},j)};return f&&h.jsx(c("PolarisDOMListener.react"),{event:"message",handler:a,target:window})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("PolarisIgFrCookieUpdaterFalcoEvent",["PolarisFalcoLogger"],(function(a,b,c,d,e,f,g){"use strict";var h={falco:!0,pigeon:!1};a=function(){function a(){}a.log=function(a){d("PolarisFalcoLogger").FalcoLogger.log("ig_fr_cookie_updater",a(),{},h)};return a}();g.IgFrCookieUpdaterFalcoEvent=a}),98);
__d("PolarisInstagramToFacebookCookieSync.react",["FBLogger","PolarisAPIGetFrCookie","PolarisDOMListener.react","PolarisFacebookCookieSyncConstants","PolarisIgFrCookieUpdaterFalcoEvent","PolarisODS","PolarisReactRedux","PolarisWebStorage","browserHistory","buildIframeOriginUrl","gkx","polarisUserSelectors","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");b=d("react");var i=b.useEffect,j=b.useRef,k=c("buildIframeOriginUrl")("https://www.facebook.com"),l="fr",m=Number(new Date().getTime());function n(a){a.total_latency=new Date().getTime()-m,d("PolarisIgFrCookieUpdaterFalcoEvent").IgFrCookieUpdaterFalcoEvent.log(function(){return a})}function a(a){var b=a.frameRef,e=a.frData,f=a.onCleanUp,g=c("gkx")("4906");a=Number(d("PolarisReactRedux").useSelector(function(a){return(a=d("polarisUserSelectors").getViewer(a))==null?void 0:a.id}));var m=d("browserHistory").getPath(d("browserHistory").browserHistory);a=j({ig_user_id:a,iframe_origin:k,is_blacklisted:!1,local_storage_same_as_api:!0,show_iframe:!1,local_storage_updated:!1,is_control_group:!1,is_local_storage_accessible:!1,browser_history_path:m,local_storage_data:e});var o=a.current;i(function(){g||(o.is_blacklisted=!0,n(o),f())},[]);m=function(a){var b=a.data.eventName;o.iframe_message_origin=a.origin;if(a.origin!==k){b in d("PolarisFacebookCookieSyncConstants").IFRAME_MESSAGES&&(o.iframe_message_origin_mismatch=!0,n(o));return}switch(b){case d("PolarisFacebookCookieSyncConstants").IFRAME_MESSAGES.ready:c("PolarisODS").incr("web.frcookie.iframe.ready");o.iframe_message_ready=!0;p();break;case d("PolarisFacebookCookieSyncConstants").IFRAME_MESSAGES.success:c("PolarisODS").incr("web.frcookie.iframe.success");o.iframe_message_success=!0;n(o);f();break;case d("PolarisFacebookCookieSyncConstants").IFRAME_MESSAGES.error:c("PolarisODS").incr("web.frcookie.iframe.error");q();o.iframe_message_error=!0;n(o);break}};var p=function(){o.iframe_non_null=!1;o.iframe_content_window_non_null=!1;var a=b.current;if(a==null)return;e==null&&c("PolarisODS").incr("web.frcookie.local_storage.empty");d("PolarisAPIGetFrCookie").getFrCookie(e).then(function(b){o.api_data=b.fr;if(b.fr===e){n(o);f();return}o.local_storage_same_as_api=!1;var g=c("PolarisWebStorage").getLocalStorage();if(g==null){n(o);f();return}o.is_local_storage_accessible=!0;if(b.fr===""){g.removeItem(l);c("PolarisODS").incr("web.frcookie.local_storage.remove");n(o);f();return}g.setItem(l,b.fr);o.show_iframe=!0;o.local_storage_updated=!0;o.iframe_payload=b.fr;o.iframe_non_null=!0;a.contentWindow!=null&&(o.iframe_content_window_non_null=!0,a.contentWindow.postMessage({data:b.fr,eventName:d("PolarisFacebookCookieSyncConstants").IFRAME_MESSAGES.sync},k));c("PolarisODS").incr("web.frcookie.local_storage.update")})["catch"](function(a){o.exception=a.toString(),n(o),c("FBLogger")("ig_web").catching(a).mustfix("Exception thrown when getting frCookie"),q()})},q=function(){var a=c("PolarisWebStorage").getLocalStorage();c("PolarisWebStorage").isLocalStorageSupported()&&a!=null&&a.removeItem(l);f()};return g&&h.jsx(c("PolarisDOMListener.react"),{event:"message",handler:m,target:window})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("PolarisFacebookCookieSyncImpl.react",["JSScheduler","PolarisDOMListener.react","PolarisFacebookToInstagramCookieSync.react","PolarisIgFrCookieUpdaterFalcoEvent","PolarisInstagramToFacebookCookieSync.react","PolarisReactRedux","PolarisUA","PolarisWebStorage","RunComet","browserHistory","buildIframeOriginUrl","polarisUserSelectors","qex","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");b=d("react");var i=b.useEffect,j=b.useRef,k=b.useState,l=c("buildIframeOriginUrl")("https://www.facebook.com"),m=l+"/instagram/login_sync/",n="fr",o=["terms","challenge"],p=Number(new Date().getTime());function q(a){a.total_latency=new Date().getTime()-p,d("PolarisIgFrCookieUpdaterFalcoEvent").IgFrCookieUpdaterFalcoEvent.log(function(){return a})}var r=function(){if(!d("PolarisUA").isIGWebview()&&!d("PolarisUA").isIgLite()&&c("PolarisWebStorage").isLocalStorageSupported()){var a=c("PolarisWebStorage").getLocalStorage();if(a!=null)return a.getItem(n)}return null};function s(a){a=a.frData;var b=j(null),e=Number(d("PolarisReactRedux").useSelector(function(a){return(a=d("polarisUserSelectors").getViewer(a))==null?void 0:a.id}));e=j({ig_user_id:e,iframe_origin:l,is_blacklisted:!1,local_storage_same_as_api:!0,show_iframe:!1,local_storage_updated:!1,is_control_group:!1,is_local_storage_accessible:!1,browser_history_path:d("browserHistory").getPath(d("browserHistory").browserHistory),local_storage_data:a});var f=e.current;e=function(){f.iframe_unload=!0};var g=k(!1),n=g[0],o=g[1];i(function(){var a=null,b=null,e=d("RunComet").onAfterLoad(function(){a=c("JSScheduler").scheduleLoggingPriCallback(function(){var a;a=(a=c("qex")._("74"))!=null?a:0;b=window.setTimeout(function(){o(!0)},a*1e3)})});return function(){b&&window.clearTimeout(b),a&&c("JSScheduler").cancelCallback(a),e&&e.remove()}},[]);g=k(!1);var p=g[0],r=g[1];g=k(!1);var s=g[0],t=g[1];g=p&&s;return!n||g?null:h.jsxs(h.Fragment,{children:[h.jsx("iframe",{onError:function(){f.iframe_on_error=!0,q(f)},onLoad:function(){f.iframe_on_load=!0},ref:b,src:m,style:{height:0,width:0,border:"none",display:"none"},title:"fr"}),h.jsx(c("PolarisInstagramToFacebookCookieSync.react"),{frameRef:b,frData:a,onCleanUp:function(){return r(!0)}}),h.jsx(c("PolarisFacebookToInstagramCookieSync.react"),{frameRef:b,onCleanUp:function(){return t(!0)}}),h.jsx(c("PolarisDOMListener.react"),{event:"beforeunload",handler:e,target:window})]})}s.displayName=s.name+" [from "+f.id+"]";function a(){var a=d("PolarisReactRedux").useSelector(function(a){return!!(a==null?void 0:(a=a.cookieModal)==null?void 0:a.visible)}),b=Number(d("PolarisReactRedux").useSelector(function(a){return(a=d("polarisUserSelectors").getViewer(a))==null?void 0:a.id}));if(a)return null;var c=d("browserHistory").getPath(d("browserHistory").browserHistory);if(o.some(function(a){return c.includes(a)})){q({ig_user_id:b,iframe_origin:l,is_blacklisted:!0,local_storage_same_as_api:!0,show_iframe:!1,local_storage_updated:!1,is_control_group:!1,browser_history_path:c,is_local_storage_accessible:!1});return null}return h.jsx(s,{frData:r()})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);